@model basics.Areas.Admin.Models.SalonListViewModel

@{
    ViewData["Title"] = "Salon Y√∂netimi";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<head>
    <link rel="stylesheet" href="~/css/salonlar-style.css"/>
</head>

<div class="main-content">
    <div class="header">
        <div>
            <h1>Tiyatro Salonlarƒ± Y√∂netimi</h1>
            <p style="color: #7f8c8d; margin-top: 5px;">Salonlarƒ± g√∂r√ºnt√ºleyin, d√ºzenleyin veya yeni salon ekleyin.</p>
        </div>
        
        <div class="stats-section">
            <div class="stat-card">
                <span class="stat-icon">üé≠</span>
                <h4>Toplam Salon</h4>
                <div class="stat-value">@Model.Salonlar.Count</div>
            </div>
            <div class="stat-card">
                <span class="stat-icon">‚úÖ</span>
                <h4>Aktif Salon Sayƒ±sƒ±</h4>
                <div   div class="stat-value">@Model.Salonlar.Count(x => x.Durum == "Aktif")</div>
</div>
        </div>

        <button class="btn-add" onclick="toggleNewSalonPanel()">
            + Yeni Salon Ekle
        </button>
         <a asp-area="Admin" asp-controller="Salon" asp-action="SalonDuzenOlustur" class="btn btn-primary ms-2">
            Yeni koltuk d√ºzeni olu≈ütur
        </a>
    </div>

    <div id="newSalonPanel" class="collapsible-panel" style="@(ViewData.ModelState.IsValid ? "" : "max-height: 500px;")">
        
        <form asp-action="Ekle" method="post" class="panel-content">
            
            <div class="filter-group">
                <label>Salon Adƒ±</label>
                <input asp-for="YeniSalon.SalonAdi" type="text" placeholder="√ñrn: B√ºy√ºk Tiyatro Salonu" required>
            </div>

            <div class="filter-group">
                <label>≈ûehir</label>
                <input asp-for="YeniSalon.Sehir" list="cityOptions" placeholder="≈ûehir se√ßiniz..." required>
                <datalist id="cityOptions">
                    <option value="ƒ∞stanbul" />
                    <option value="Ankara" />
                    <option value="ƒ∞zmir" />
                    <option value="Bursa" />
                    <option value="Antalya" />
                </datalist>
            </div>

            <div class="filter-group">
                <label>Koltuk D√ºzeni</label>
                <select asp-for="YeniSalon.KoltukDuzeni" id="layoutSelect" onchange="updateCapacityFromLayout()" required>
                    <option value="" disabled selected>Bir d√ºzen se√ßiniz...</option>
                    @foreach (var plan in Model.Planlar)
                    {
                        <option value="@plan.PlanAdi" data-capacity="@plan.Kapasite">
                            @plan.PlanAdi (Kapasite: @plan.Kapasite)
                        </option>
                    }
                </select>
            </div>

            <div class="filter-group">
                <label>Salon Kapasitesi</label>
                <input type="text" id="salonCapacity" placeholder="Otomatik" readonly>
            </div>

            <div class="panel-actions">
                <button type="submit" class="btn-save">Kaydet ve Ekle</button>
            </div>
        </form>
    </div>
    <div class="filters-section">
        <div class="filters-header">
            <h3>üîç Filtrele ve Ara</h3>
            <button class="btn-action btn-view" onclick="resetFilters()">Filtreleri Temizle</button>
        </div>
        <div class="filter-controls">
            <div class="filter-group">
                <label>Arama</label>
                <input type="text" id="searchInput" placeholder="Salon adƒ± ara..." onkeyup="applyFilters()">
            </div>
             <div class="filter-group">
                <label>≈ûehir</label>
                <select id="cityFilter" onchange="applyFilters()">
                <option value="">T√ºm√º</option>
                @foreach (var sehir in Model.MevcutSehirler)
                {
                    <option value="@sehir">@sehir</option>
             }
    </select>
</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Salon Adƒ±</th>
                    <th>≈ûehir</th>
                    <th>Koltuk D√ºzeni</th>
                    <th>Kapasite</th>
                    <th>Durum</th> <th>ƒ∞≈ülemler</th>
                </tr>
            </thead>
            <tbody id="theaterTableBody">
                @if (Model.Salonlar.Count > 0)
                {
                    @foreach (var salon in Model.Salonlar)
                    {
                        <tr>
                            <td><strong>@salon.SalonAdi</strong></td>
                            <td>@salon.Sehir</td>
                            <td>@salon.KoltukDuzeni</td>
                            <td><span class="badge bg-primary">@salon.SalonKapasitesi</span></td>
                            <td>
                                @if (salon.Durum == "Aktif")
                                {
                                    <span class="badge bg-success">Aktif</span>
                                }
                                else
                                {
                                    <span class="badge bg-warning text-dark">Pasif</span>
                                }
                            </td>
                            <td>
                                <a href="/Admin/Salon/Sil/@salon.Id" class="text-danger" style="font-size: 1.2rem;" onclick="return confirm('Silmek istediƒüinize emin misiniz?');" title="Sil">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center" style="padding: 20px;">Hen√ºz kayƒ±tlƒ± salon bulunmamaktadƒ±r.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script>
    function toggleNewSalonPanel() {
        var panel = document.getElementById("newSalonPanel");
        if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
        } else {
            panel.style.maxHeight = panel.scrollHeight + "px";
        }
    }

    function updateCapacityFromLayout() {
        var selectBox = document.getElementById("layoutSelect");
        var capacityInput = document.getElementById("salonCapacity");
        var selectedOption = selectBox.options[selectBox.selectedIndex];
        var capacity = selectedOption.getAttribute("data-capacity");
        
        if(capacity) {
            capacityInput.value = capacity;
        } else {
            capacityInput.value = "";
        }
    }

    function applyFilters() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchInput");
        filter = input.value.toUpperCase();
        table = document.querySelector("table");
        tr = table.getElementsByTagName("tr");

        for (i = 1; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[0];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }

    function resetFilters() {
        document.getElementById("searchInput").value = "";
        applyFilters();
    }
</script>